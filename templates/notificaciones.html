{% extends "base.html" %}

{% block title %} - Notificaciones{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-inbox"></i> Buzón de Notificaciones</h2>
        <button class="btn btn-outline-primary" onclick="marcarTodas()">
            <i class="fas fa-check-double"></i> Marcar todas como leídas
        </button>
    </div>
    
    <div class="card">
        <div class="card-body p-0">
            {% if notificaciones %}
            <div class="list-group list-group-flush">
                {% for notif in notificaciones %}
                <div class="list-group-item d-flex justify-content-between align-items-start {% if not notif.leida %}list-group-item-info{% endif %}">
                    <div class="ms-2 me-auto">
                        <div class="fw-bold">
                            {% if notif.tipo == 'pago' %}Pago
                            {% elif notif.tipo == 'asistencia' %}Asistencia
                            {% elif notif.tipo == 'retraso' %}Retraso
                            {% elif notif.tipo == 'estudiante' %}Estudiante
                            {% else %}Sistema
                            {% endif %}
                        </div>
                        {{ notif.mensaje }}
                        <div class="text-muted small mt-1">{{ notif.fecha.strftime('%d/%m/%Y %H:%M') }}</div>
                    </div>
                    {% if notif.link %}
                    <a href="{{ notif.link }}" class="btn btn-sm btn-outline-secondary">
                        <i class="fas fa-arrow-right"></i> Ir
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">No hay notificaciones</h5>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function marcarTodas() {
    fetch('/api/notificaciones/marcar_todas_leidas', { method: 'POST' })
        .then(() => location.reload())
        .catch(() => {});
}

// Al abrir el buzón, marcar todas como leídas
document.addEventListener('DOMContentLoaded', () => {
    fetch('/api/notificaciones/marcar_todas_leidas', { method: 'POST' })
        .catch(() => {});
});
</script>
{% endblock %}
